<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AIC Tasks - Firebase Demo</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;max-width:900px;margin:32px auto;padding:0 16px;}
    h1{margin-bottom:8px}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
    input[type=email]{flex:1;min-width:260px;padding:10px 12px;border:1px solid #ddd;border-radius:8px}
    button{padding:10px 14px;border-radius:8px;border:0;background:#0d6efd;color:#fff;cursor:pointer}
    button.secondary{background:#6c757d}
    ul{margin-top:16px;padding-left:18px}
    li{margin:6px 0}
    #status{margin-top:8px;font-size:14px;color:#555}
    .ok{color:#198754} .bad{color:#dc3545}
    footer{margin-top:28px;color:#666;font-size:13px}
    code{background:#f6f8fa;padding:2px 6px;border-radius:6px}
  </style>
</head>
<body>
  <h1>AIC Tasks â€“ Firebase</h1>
  <div id="status">Duke u lidhurâ€¦</div>

  <div class="row">
    <button id="btnLoad" class="secondary">ðŸ“¥ Shfaq Users</button>
    <input id="email" type="email" placeholder="p.sh. editor@aicorporation.al" />
    <button id="btnAdd">âž• Shto User</button>
  </div>

  <ul id="userList"></ul>

  <!-- Firebase SDK (modular via CDN) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp } 
      from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    // âœ… Config i projektit tÃ«nd
    const firebaseConfig = {
      apiKey: "AIzaSyDjttdgfTjtLtxdDNSYIqtKmh4FNYaB9vw",
      authDomain: "aic-projects-57baa.firebaseapp.com",
      projectId: "aic-projects-57baa",
      storageBucket: "aic-projects-57baa.firebasestorage.app",
      messagingSenderId: "267074355981",
      appId: "1:267074355981:web:38dd5942c5c8849218e644",
      measurementId: "G-4X4GTKYP2R"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const status = document.getElementById('status');
    status.innerHTML = '<span class="ok">Lidhja me Firebase u inicializua âœ”</span>';

    // Path: Collection = aic, Document = aic-projects-57baa
    const ref = doc(db, "aic", "aic-projects-57baa");

    async function ensureDocExists(){
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        await setDoc(ref, { users: [], updatedAt: serverTimestamp() });
      }
    }

    async function loadUsers(){
      await ensureDocExists();
      const snap = await getDoc(ref);
      const data = snap.data();
      const users = Array.isArray(data.users) ? data.users : [];
      const ul = document.getElementById('userList');
      ul.innerHTML = users.map(e => '<li>'+e+'</li>').join('') || '<li>(bosh)</li>';
    }

    async function addUser(email){
      await ensureDocExists();
      const snap = await getDoc(ref);
      const data = snap.data();
      const arr = Array.isArray(data.users) ? data.users.slice() : [];
      if (!email) throw new Error('Vendos email');
      if (!arr.includes(email)) arr.push(email);
      await updateDoc(ref, { users: arr, updatedAt: serverTimestamp() });
      await loadUsers();
    }

    // UI events
    document.getElementById('btnLoad').addEventListener('click', loadUsers);
    document.getElementById('btnAdd').addEventListener('click', async () => {
      const v = document.getElementById('email').value.trim();
      try{
        await addUser(v);
        document.getElementById('email').value='';
        status.innerHTML = '<span class="ok">U ruajt nÃ« Firestore âœ”</span>';
      }catch(e){
        console.error(e);
        status.innerHTML = '<span class="bad">Gabim: '+(e.message||e)+'</span>';
      }
    });

    // Auto-load users nÃ« hapje
    loadUsers().catch(e => {
      console.error(e);
      status.innerHTML = '<span class="bad">Nuk u lexua nga Firestore</span>';
    });
  </script>

  <footer>
    Koleksioni: <code>aic</code> â€¢ Dokumenti: <code>aic-projects-57baa</code> â€¢ Fusha: <code>users</code> (array)
  </footer>
</body>
</html>
